<!-- tag: Code-Passages -->
<!-- StoryInit -->
<StoryInit>
    /* 删除自带的menu边栏按钮 */
    <<remove "#menu-core">>

    /* 阿诺德初始化 */
    <<set $arnold = {
        health: 100,
        fatigue: 0,
        stress: 0,
        control: 100,
        inventory: {},
    }>>
    /* 特殊物品和任务进度追踪*/
    <<set $unique = {}>>

    /* 时间变量初始化 */
    <<set $time to {
        minute: 0,
        hour: 7,
        day: 21,
        week: 4,
        month: 1,
        year: 417,
    }>>

    /* 文字变量初始化 */
    <<set $hint to []>>
    <<set $display to {
        month: ["春", "夏", "秋", "冬"],
        week: ["一", "二", "三", "四", "五", "六", "日"],
        hour: 0,
        minute: 0,
    }>>

    /*小树枝语快速插入初始化*/
    <<set $twig = {
        A: "<img src='img/twig/A.png'>",
        B: "<img src='img/twig/B.png'>",
        C: "<img src='img/twig/C.png'>",
        D: "<img src='img/twig/D.png'>",
        E: "<img src='img/twig/E.png'>",
        F: "<img src='img/twig/F.png'>",
        G: "<img src='img/twig/G.png'>",
        H: "<img src='img/twig/H.png'>",
        I: "<img src='img/twig/I.png'>",
        J: "<img src='img/twig/J.png'>",
        K: "<img src='img/twig/K.png'>",
        L: "<img src='img/twig/L.png'>",
        M: "<img src='img/twig/M.png'>",
        N: "<img src='img/twig/N.png'>",
        O: "<img src='img/twig/O.png'>",
        P: "<img src='img/twig/P.png'>",
        Q: "<img src='img/twig/Q.png'>",
        R: "<img src='img/twig/R.png'>",
        S: "<img src='img/twig/S.png'>",
        T: "<img src='img/twig/T.png'>",
        U: "<img src='img/twig/U.png'>",
        V: "<img src='img/twig/V.png'>",
        W: "<img src='img/twig/W.png'>",
        X: "<img src='img/twig/X.png'>",
        Y: "<img src='img/twig/Y.png'>",
        Z: "<img src='img/twig/Z.png'>"
    } >>

    /*小图标快速插入初始化*/
    <<set $icon = {
        
    }>>
</StoryInit>

<!-- StoryBanner -->
<StoryBanner
    <div id="banner-container" tooltip="<<bannerTooltip>>">
        <img src="img/storybanner/border.png" id="banner-border">\
        <img src="img/storybanner/base.png" id="banner-base">\
        <img src="img/storybanner/default.png" id="banner-cloth">\
    </div>
</StoryBanner>

<!-- StoryCaption -->   
<StoryCaption>
    <<if passage() is "Title">>
		<div id="menu-button">
        <a id="saves-button">存档</a>
        @@#menu-bottom;
        <a id="settings-button">设置</a>
        <a id="achievement-button">成就</a>
        @@
        </div>
        <<else>>
        <div id="time-display">\
        <hr>\
        <<time>>
        <hr>\
        </div>
        \<div id="stat-bar">\
            <div tooltip="疲劳：$arnold.fatigue" id="fatigue">
                疲劳：<<statBar "fatigue">>
                <meter min="0" low="25" high="75" optimum="20" max="100" @value=$arnold.fatigue></meter>
            </div>\
            <div tooltip="压力：$arnold.stress" id="stress">\
                压力：<<statBar "stress">>
                <meter min="0" low="25" high="75" optimum="20" max="100" @value=$arnold.stress></meter>
            </div>\
            <div tooltip="自控：$arnold.control" id="control">\
                自控：<<statBar "control">>
                <meter min="0" low="30" high="75" optimum="80" max="100" @value=$arnold.control></meter>
            </div>\
            <div tooltip="健康：$arnold.health" id="health">\
                健康：<<statBar "health">>
                <meter min="0" low="30" high="75" optimum="80" max="100" @value=$arnold.health></meter>
            </div>
        </div>
        提示：<<print $hint>>
        
        
        <div id="menu-button">
            \<a id="status-button">属性</a>
            \<a id="social-button">社交</a>
            \@@#menu-middle;
            \<a id="inventory-button">物品</a>
            \<a id="journal-button">日志</a>
            \@@
            <a id="saves-button">存档</a>
            @@#menu-bottom;
            <a id="settings-button">设置</a>
            <a id="achievement-button">成就</a>
            @@
        </div>\
    <</if>>
</StoryCaption>

<!-- ==================================================================== -->
<!-- tag: widget -->
<!-- time -->
<<nobr>>
    <<widget "time">>
        /* 满60分钟加1小时 */
        <<if $time.minute >= 60>>
            <<set $time.minute = 0>>
            <<set $time.hour += 1>>
        <</if>>
        /* 满24小时加1天 */
        <<if $time.hour >= 24>>
            <<set $time.hour = 0>>
            <<set $time.day += 1>>
            <<set $time.week += 1>>
        <</if>>
        /* 满7天加1周 */
        <<if $time.week >= 7>>
            <<set $time.week = 0>>
        <</if>>
        /* 满30天加1月 */
        <<if $time.day >= 30>>
            <<set $time.day = 1>>
            <<set $time.month += 1>>
        <</if>>
        /* 满4月加1年 */
        <<if $time.month >= 4>>
            <<set $time.month = 0>>
            <<set $time.year += 1>>
        <</if>>
        /* 显示时间 */
        <<if $time.hour < 10>>
            <<set $display.hour = "0" + $time.hour>>
        <<else>> 
            <<set $display.hour = $time.hour>>
        <</if>>
        <<if $time.minute < 10>>
            <<set $display.minute = "0" + $time.minute>>
        <<else>> 
            <<set $display.minute = $time.minute>>
        <</if>>
        $time.year年 <<print $display.month[$time.month]>> $time.day日 星期<<print $display.week[$time.week]>> $display.hour:$display.minute
    <</widget>>
<</nobr>>

<!-- addTime -->
<<nobr>>
    <<widget "addTime">>
        <<set $time.minute += Number(_args[0])>>
    <</widget>>
<</nobr>>

<!-- addStat -->
<<nobr>>
    <<widget "addStat">>
        <<set $arnold[_args[0]] += Number(_args[1])>>
        <<if $arnold.fatigue >= 100 or $arnold.stress >= 100>>   
        /* 如果疲劳过度或压力过大，则昏倒 */
            <<set _passage to "Faint">>
        <</if>>
        /* 如果健康小于0，则死亡 */
        <<if $arnold.health <= 0>>
            <<set _passage to "BE-Death">>
            /* 如果健康过低，则有一定几率昏倒 */
            <<elseif $arnold.health <= 30>>
                <<set _random to random(1, 100)>>
                <<if _random <= 90>>
                    <<addStat "control" -1>>
                    <<addStat "stress" 1>>
                    <<addStat "fatigue" 1>>
                    <<else>>
                        <<set _passage to "Faint">>
                <</if>>
        <</if>>
        <<goto _passage>>
    <</widget>>
<</nobr>>

<!-- bannerTooltip -->
<<nobr>>
    <<widget "bannerTooltip">>
        你在室内。温度很舒适。你穿着你的白大褂。
    <</widget>>
<</nobr>>

<!-- statBar -->
<<nobr>>
    <<widget "statBar">>
        <<if $arnold.fatigue is 0>>
            <<set _fatigue to "你感觉体力充沛">>
            <<set _fcolor to "green">>
        <<elseif $arnold.fatigue <= 10>>
            <<set _fatigue to "你并不觉得累">>
            <<set _fcolor to "greenyellow">>
        <<elseif $arnold.fatigue <= 30>>
            <<set _fatigue to "你感觉有些疲劳">>
            <<set _fcolor to "sandybrown">>
        <<elseif $arnold.fatigue <= 50>>
            <<set _fatigue to "你有些疲惫，但还能勉强应付">>
            <<set _fcolor to "salmon">>
        <<elseif $arnold.fatigue <= 80>>
            <<set _fatigue to "你非常疲倦，需要休息">>
            <<set _fcolor to "tomato">>
        <<else>>
            <<set _fatigue to "你已经精疲力尽">>
            <<set _fcolor to "red">>
        <</if>>
        <<if $arnold.stress is 0>>
            <<set _stress to "你十分平静">>
            <<set _scolor to "green">>
        <<elseif $arnold.stress <= 10>>
            <<set _stress to "你仍然能保持冷静">>
            <<set _scolor to "greenyellow">>
        <<elseif $arnold.stress <= 30>> 
            <<set _stress to "你有些焦虑">>
            <<set _scolor to "sandybrown">>
        <<elseif $arnold.stress <= 50>>
            <<set _stress to "你倍感压力，几乎喘不上气来">>
            <<set _scolor to "salmon">>
        <<elseif $arnold.stress <= 80>>
            <<set _stress to "你的压力到了极限，几乎承受不住">>
            <<set _scolor to "tomato">>
        <<else>>
            <<set _stress to "你已经濒临崩溃">>
            <<set _scolor to "red">>
        <</if>>
        <<if $arnold.control >= 100>>
            <<set _control to "你充满自信">>
            <<set _ccolor to "green">>
        <<elseif $arnold.control >= 80>>
            <<set _control to "你仍能掌控局势">>
            <<set _ccolor to "greenyellow">>
        <<elseif $arnold.control >= 50>>
            <<set _control to "你感觉自己有些失控">>
            <<set _ccolor to "salmon">>
        <<elseif $arnold.control >= 25>>
            <<set _control to "你充满忧虑">>
            <<set _ccolor to "tomato">>
        <<else>>
            <<set _control to "你完全失去了自控能力">>
            <<set _ccolor to "red">>
        <</if>>
        <<if $arnold.health >= 100>>
            <<set _health to "你的身体十分健康">>
            <<set _hcolor to "green">>
        <<elseif $arnold.health >= 80>>
            <<set _health to "你还算健康">>
            <<set _hcolor to "greenyellow">>
        <<elseif $arnold.health >= 50>>
            <<set _health to "你感觉有些虚弱">>
            <<set _hcolor to "salmon">>        
        <<elseif $arnold.health >= 30>>
            <<set _health to "你感到十分不适，需要休息">>
            <<set _hcolor to "tomato">>
        <<else>>
            <<set _health to "你的身体状况很糟糕">>
            <<set _hcolor to "red">>
        <</if>>
        <<if _args[0] is "fatigue">>
            <<print "<span style='color:" + _fcolor + ";'>" + _fatigue + "</span>">>
        <<elseif _args[0] is "stress">>
            <<print "<span style='color:" + _scolor + ";'>" + _stress + "</span>">>
        <<elseif _args[0] is "control">>
            <<print "<span style='color:" + _ccolor + ";'>" + _control + "</span>">>
        <<elseif _args[0] is "health">>
            <<print "<span style='color:" + _hcolor + ";'>" + _health + "</span>">>
        <</if>>
    <</widget>>
<</nobr>>

/* ==================================================================== */
/* tag: event */
/* Faint */
<<nobr>>
    <<set _fatigue to true>>
    <<set _stress to true>>
    <<set _health to true>>
    <<if $arnold.fatigue >= 100 and $arnold.stress < 90>>
        <<set _stress to false>>
        <<elseif $arnold.stress >= 100 and $arnold.fatigue < 90>>
            <<set _fatigue to false>>
        <<else>>
            <<set _fatigue to false>>
            <<set _stress to false>>
    <</if>>        
    <<if $arnold.health > 30>>
        <<set _health to false>>
    <</if>>
    <<if _fatigue and _stress and _health>>
        <<set _print to "你的身体已经达到极限，疲劳、压力和虚弱感交织在一起，让你再也无法支撑。眼前的世界变得模糊，意识渐渐远去，你无力地倒在地上，陷入深深的昏迷。">>
    <<elseif _fatigue and _stress>>
        <<set _print to "持续的疲劳与沉重的压力压得你喘不过气来。你的身体摇摇欲坠，意识开始飘忽，最终双腿一软，眼前一黑，彻底昏了过去。">>
    <<elseif _fatigue and _health>>
        <<set _print to "过度的疲劳让你的四肢沉重，而虚弱的身体再也无法支撑。你感到一阵眩晕，步伐踉跄，紧接着便失去了意识，重重倒下。">>
    <<elseif _stress and _health>>
        <<set _print to "压力如同一座无形的大山，让你的内心濒临崩溃，而身体的虚弱更让你无法支撑。你感到心跳加速，胸口发闷，最后在极度的不适中昏倒过去。">>
    <<elseif _fatigue>>
        <<set _print to "长时间的疲惫让你的身体彻底透支，沉重的眼皮再也抬不起来。你踉跄几步，最终倒在地上，陷入深深的昏迷。">>
    <<elseif _stress>>
        <<set _print to "焦虑和压力不断积聚，如同无形的枷锁束缚着你的精神。你的大脑一片混沌，意识逐渐模糊，最终在崩溃的边缘失去了知觉。">>
    <<elseif _health>>
        <<set _print to "你的身体太过羸弱，此时连站立都变得困难。你试图深呼吸，却感到一阵头晕目眩，眼前一黑，便失去了所有知觉。">>
    <</if>>
<</nobr>>\
@@#faint;\
// _print //


<<link "醒来 (3:00)">>
        <<replace "#faint" t8n>>test<</replace>>
<</link>>
@@

/* ==================================================================== */